{% extends 'layout.html' %}

{% block head_ext %}
    <title>Recipe</title>
{% endblock head_ext %}

{% block content %}

        <div class="py-5 bg-light">
            <div class="container">
                <div class="justify-content-center">
                    <div class="overflow-hidden">
                        <img src="{{ recipe[1].photo_url }}" class="w-25" height="325">
                        <div class="float-end" style="width:70%">
                            <div class="d-flex justify-content-between">
                                <div>
                                    {%if edit %}
                                    <input type="text" value="{{recipe[1].recipe_name}}">
                                    {%endif %}
                                    {%if not edit %}
                                    <h1 class="display-3">{{ recipe[1].recipe_name }}</h1>
                                    <h3 class="display-6">A {{ recipe[1].meal_name }} recipe</h3>
                                    {% endif %}
                                </div>
                                <div class="mt-3">
                                    <a href="/user/{{owner}}" style="display:block; background-color: #DEE1E6; width: 140px; height:140px; border-radius: 50%;"><img style="padding:25px;" src="/static/img/profile.png" width="140" height="auto"></a>
                                </div>
                            </div>
                            
                            
                            <div class="mt-5">
                                <p>{{ recipe[1].instruction }}</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="text-center">
                            <h1 class="display-3">Ingredients</h1>
                        </div>
                        
                            <div class="row mt-3">
                            {%if ingredients%}
                            {%for key, ingredient in ingredients%}
                            
                                <div class="card col-sm-3">
                                    <form action="/recipe/{{recipe[0]}}" method="POST">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ ingredient.name }}</h5>
                                            <p class="card-text">{{ ingredient.measurement_quantity }}</p>
                                            {%if user==owner%}
                                                <input type="text" name="ing_of_meals_id" value="{{key}}" style="display:none">
                                                <button type="button" class="btn btn-outline-secondary dropdown-ingredient">Edit</button>
                                                <button type="submit" style="display:none;" name="button" class="btn btn-outline-primary update-btn" id="{{key}}" value="updateIng">Update</button>
                                                <button type="submit" name="button" class="btn btn-outline-danger" value="deleteIng" id="{{key}}">Delete</button>
                                            {% endif %}
                                            </form>
                                        </div>
                                </div>
                           
                            {%endfor%}
                            {%endif%}
                            </div>
                            {%if user==owner%}
                            <div class="row row-cols-1 row-cols-sm-4 d-flex justify-content-center">
                                <form method="POST" class="signin-form" action="/recipe/{{recipe[0]}}/addIng">
                                    <div class="form-group me-2 mt-2">
                                    <button type="submit" name="button" value="addIngredient" class="form-control btn btn-dark submit px-3">
                                        Add ingredient
                                    </button>
                                    </div>
                                </form>
                            </div>
                            {%endif%}
                        <div class="text-center mt-3">
                            <h1 class="display-3">Comments</h1>
                        </div>

                        {%if comments%}
                        {%for key, comment in comments%}
                        <form method="POST" action="/recipe/{{comment.recipe_id}}">
                            <div class="card mb-3">
                                <div class="card-body">
                                <h5 class="card-title">{{ comment.user_name }}</h5>
                                <p class="card-text" style="color:{{ comment.text_color }};">{{ comment.message }}</p>
                                {%if user==comment.user_id%}<button type="button" class="btn btn-primary convert2textbox" id="{{key}}">Edit Comment</button>{%endif%}
                                {%if user==comment.user_id%}<button type="submit" class="btn btn-danger" name="button" value="delete-comment">Delete Comment</button>{%endif%}
                                {%if user==comment.user_id%}<input type="text" class="invisible" name="id2delete" value="{{key}}">{%endif%}
                                <input value="{{key}}", type="text", class="invisible", name="comment_id">
                                <div class="mt-1 language-div"><small class="text-muted"> Created {{ comment.created_date }}. Language is <span id="language-span">{{ comment.language }}</span></small></div>
                                {%if comment.updated_date%}<div class="mt-1"><small class="text-muted"> Updated {{ comment.updated_date }}</small></div>{%endif%}
                                </div>
                            </div>
                        </form>
                        {%endfor%}
                        {%endif%}

                        {%if not comments%}
                        <div class="card mb-5">
                            <div class="card-body">
                              <h5 class="card-title">There are no comments yet. You can be the first one to comment!</h5>
                            </div>
                        </div>
                        {%endif%}

                        <form action="/recipe/{{recipe[0]}}" method="POST">
                            <div class="mb-3 mt-3">
                              <label for="comment" class="form-label">Make a Comment</label>
                              <textarea class="form-control" rows="7" cols="175" placeholder="You can comment here" id="comment" name="message"></textarea>
                              <div id="emailHelp" class="form-text">You have a limit of 200 characters.</div>
                            </div>

                            <label class="form-label">You can pick a text color for your comment! (please do not choose light colors)</label>
                            <input type="color" class="form-control form-control-color mb-3" id="exampleColorInput" name="color" value="#563d7c" title="Choose your color">
                            
                            <label class="form-label">Please enter the language of the comment</label>
                            <div class="w-100">
                                <input type="text" class="form-text" name="language" placeholder="Language">
                            </div>
                            

                            <button type="submit" class="btn btn-dark mt-2" name="button" value="comment">Submit</button>
                        </form>
                    </div>


                </div>            
            </div>
        </div>
        <script>
            $(".convert2input").click(function() {
                var input = $("<input>", { val: $(this).prev().text(),
                                        type: "text",
                                        name: $(this).attr("id")});
                $(this).prev().replaceWith(input);
                $(this).prev().addClass("d-inline card-text mb-2");

                //$(this).prev().attr("name", $(this).attr("id"));

                $(this).remove();

                input.select();
            });
            $(".dropdown-ingredient").click(function() {
                $(this).prev().prev().prev().replaceWith('<select class="form-select" name="ingredient_id" aria-label="Default select example"><option selected>Select ingredient</option>{%if allingredients%}{%for key, ingredient in allingredients%}<option value="{{key}}">{{ingredient.name}}</option>{%endfor%}{%endif%}</select>');
                $(this).prev().prev().replaceWith('<label for="quantity" style="margin-right:10px; margin-top:10px;" class="form-label">Quantity: </label><input type="text" name="quantity">');
                $("#submit-form").removeClass("invisible");

                $(this).next().css("display","");
                $(this).remove();
            });

            $(".convert2textbox").click(function() {
                var input = $("<textarea>", { val: $(this).prev().text(),
                                        type: "text",
                                        placeholder: "Comment",
                                        name: "message"});
                $(this).prev().replaceWith(input);
                //$(this).prev().addClass("d-inline card-text mb-2");

                //$(this).prev().attr("name", $(this).attr("id"));

                $(this).after('<button type="submit" class="btn btn-dark" name="button" value="updateComment">Submit</button>');

                $(this).after('<input type="color" class="form-control form-control-color mb-3" id="exampleColorInput" name="color" value="#563d7c" title="Choose your color">');

                var value = $(this).parent().children(".language-div").children().children().text();
                $(this).after("<div class='w-100 mt-1'><input type='text' class='form-text' value='"+value+"' name='language' placeholder='Language'></div>");

                var input2 = $("<input>", {value: $(this).attr("id"), type: "text", class: "invisible", name: "comment_id"});
                $(this).after(input2);

                $(this).remove();

                input.select();
            });
        </script>
{% endblock %}

